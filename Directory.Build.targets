<?xml version="1.0" encoding="utf-8"?>
<Project>
  <Target Name="ClearGameAssetCopyLocal" AfterTargets="ResolveAssemblyReferences">
    <ItemGroup>
      <ReferenceCopyLocalPaths Remove="$(GameFolder)\*" />
    </ItemGroup>
  </Target>
  <Target Name="ILRepack" AfterTargets="Build">
    <ItemGroup>
      <InternalizeExcludeAssemblies Include="Assembly-CSharp.dll" />
      <InternalizeExcludeAssemblies Include="Assembly-CSharp-firstpass.dll" />
    </ItemGroup>
    <ILRepack 
        TargetPlatformVersion="v2"
        OutputType="SameAsPrimaryAssembly"
        MainAssembly="$(TargetPath)" 
        OutputAssembly="$(TargetPath)" 
        InputAssemblies="$(TargetDir)\*.dll" 
        WilcardInputAssemblies="true"
        WorkingDirectory="$(GameFolder)" />
  </Target>
  <Target Name="InstallModToUserDocuments" AfterTargets="ILRepack" Condition=" '$(AssemblyName)' != 'SkyLib' ">
    <PropertyGroup>
      <InstallFolder>$(ModFolder)\$(ProjectName)</InstallFolder>
    </PropertyGroup>
    <ItemGroup>  
      <AnimFiles Include="$(ProjectDir)\anim\**\*.*" />
    </ItemGroup>  

    <Copy SourceFiles="@(AnimFiles)" DestinationFiles="@(AnimFiles->'$(InstallFolder)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="$(TargetPath)" DestinationFiles="$(InstallFolder)\$(TargetFileName)" />
  </Target>
</Project>
